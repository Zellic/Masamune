# Lines of code  https://github.com/reserve-protocol/protocol/blob/27a3472d553b4fa54f896596007765ec91941348/contracts/p1/AssetRegistry.sol#L91-L104   # Vulnerability details  ## Impact The AssetRegistry contains an `unregister` function which can be used to detach a bad collateral from the RToken system.  Previously [M-16](https://github.com/code-423n4/2023-01-reserve-findings/issues/254) was reported as an issue for the RToken system in which a single bad collateral can stop the working of RToken protocol.  To fix M-16, the `basketHandler.quantity` call was wrapped in a `try/catch` block so that the statement can handle any unexpected revert from the collateral contract.  While the fix handles unexpected reverts, it misses the case which the `basketHandler.quantity` call may consume the entire transaction gas.  So, if for some reasons the Collateral contract start consuming more gas than the allowed block gas limit, the `basketHandler.quantity` call will always fail, resulting in the revert of `unregister` call.  This essentially prevent governance from unregistering a collateral from the RToken. The unregistering of a collateral is still dependent upon the code execution of the collateral token contract.   ## Proof of Concept Consider this scenario:   - TokenA was registered as an asset in AssetRegistry.  - Due to an upgrade/bug/hack the TokenA starts consuming all available gas on function calls.  - The RToken governance decides to unregister the TokenA asset and calls the `AssetRegistry.unregister` function.  - Internal call chain invokes any function of TokenA contract. The txn reverts with an out of gas error.  - The governance is now unable to unregister TokenA from RToken protocol and RToken is now unusable.  ## Tools Used Manual review  ## Recommended Mitigation Steps Consider detaching the interaction with collateral contract completely from the unregistering contract flow. Unregistering a contract must never depend upon the code execution of Collateral token contract.
