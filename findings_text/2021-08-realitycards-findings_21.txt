# Handle  gpersoon   # Vulnerability details  ## Impact The function rentAllCards of RCMarket checks for _maxSumOfPrices to see you are not paying more that you want.  However the first part of the calculations (which calculate _actualSumOfPrices ), do not take in account the fact that you might  already own a card. (while the second part of the code does). If you already own the card you don't have to pay for it and you certainly don't have to pay the extra minimumPriceIncreasePercent.  The code at "Proof of Concept" shows a refactored version of the code (see other issue "make code of rentAllCards easier to read"). This immediately shows the issue.  ## Proof of Concept // https://github.com/code-423n4/2021-08-realitycards/blob/main/contracts/RCMarket.sol#L691 ==> simplified version  function calc(uint256 currentPrice) returns(uint256) {         if (currentPrice == 0)              return MIN_RENTAL_VALUE;         return (currentPrice *(minimumPriceIncreasePercent + 100)) / 100;     }          function rentAllCards(uint256 _maxSumOfPrices) external override {       ..         uint256 _actualSumOfPrices = 0;         for (uint256 i = 0; i < numberOfCards; i++) {             _actualSumOfPrices += calc(card[i].cardPrice);   // no check for  (ownerOf(i) != msgSender()) {         }         require(_actualSumOfPrices <= _maxSumOfPrices, "Prices too high");          for (uint256 i = 0; i < numberOfCards; i++) {             if (ownerOf(i) != msgSender()) {                 uint256 _newPrice=calc(card[i].cardPrice);                 newRental(_newPrice, 0, address(0), i);             }         }     }  ## Tools Used  ## Recommended Mitigation Steps Add "if (ownerOf(i) != msgSender()) {" also in the first part of the code of rentAllCards          uint256 _actualSumOfPrices = 0;         for (uint256 i = 0; i < numberOfCards; i++) {              if (ownerOf(i) != msgSender()) {              // extra if statement                  _actualSumOfPrices += calc(card[i].cardPrice);                 }         }         
